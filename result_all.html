<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å…¨å“¡ã®çµæœä¸€è¦§</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #000;
      color: #ffeb3b;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #ffeb3b;
      letter-spacing: 2px;
    }

    .board {
      width: 95%;
      max-width: 600px;
      margin: 0 auto;
      background: #111;
      border: 3px solid #ffeb3b;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 15px rgba(255, 235, 59, 0.5);
    }

    .item {
      border-bottom: 1px solid #555;
      padding: 12px 5px;
      text-align: left;
      opacity: 0;
      transform: translateY(20px);
      animation: show 0.6s forwards;
    }

    @keyframes show {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hit {
      color: #ffeb3b;
      font-weight: bold;
      text-shadow: 0 0 8px #ffeb3b;
    }

    .miss {
      color: #ff5252;
      font-weight: bold;
      text-shadow: 0 0 8px #ff5252;
    }

    .back-btn {
      margin-top: 25px;
      padding: 12px 25px;
      font-size: 1.2em;
      border: none;
      border-radius: 8px;
      background: #ffeb3b;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 10px #ffeb3b;
    }
  </style>
</head>
<body>

  <h1>ğŸ‡ å…¨å“¡ã®çµæœä¸€è¦§</h1>

  <div class="board" id="resultBoard"></div>

  <button class="back-btn" onclick="location.href='index.html'">
    ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
  </button>

  <script>
    function getPlayerValue(id) {
      const v = localStorage.getItem("player_" + id + "_value");
      return v ? parseInt(v, 10) : 5;
    }

    function isHitWithTies(pred, actual, values) {
      const v1 = values.find(v => v.id === actual[0]).value;
      const v2 = values.find(v => v.id === actual[1]).value;
      const v3 = values.find(v => v.id === actual[2]).value;

      if (pred[0] !== actual[0]) return false;

      if (v2 === v3) {
        const setPred = new Set([pred[1], pred[2]]);
        const setActual = new Set([actual[1], actual[2]]);
        return [...setPred].every(x => setActual.has(x));
      }

      return pred[1] === actual[1] && pred[2] === actual[2];
    }

    function loadAllResults() {
      const history = JSON.parse(localStorage.getItem("trifecta_history") || "[]");
      const board = document.getElementById("resultBoard");

      if (history.length === 0) {
        board.innerHTML = "<p>ã¾ã çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        return;
      }

      const count = parseInt(localStorage.getItem("playerCount") || "3", 10);
      const values = [];
      for (let i = 1; i <= count; i++) {
        values.push({ id: i, value: getPlayerValue(i) });
      }

      values.sort((a, b) => b.value - a.value);

      const actual1 = values[0].id;
      const actual2 = values[1].id;
      const actual3 = values[2].id;

      const v2 = values[1].value;
      const v3 = values[2].value;

      board.innerHTML = "";

      history.slice().reverse().forEach((h, index) => {
        const predicted = [Number(h.first), Number(h.second), Number(h.third)];
        const actual = [actual1, actual2, actual3];

        const hit = isHitWithTies(predicted, actual, values);

        const div = document.createElement("div");
        div.className = "item";
        div.style.animationDelay = `${0.1 * index}s`;

        div.innerHTML = `
          <strong>${h.name}</strong><br>
          äºˆæƒ³ï¼š${h.first} â†’ ${h.second} â†’ ${h.third}<br>
          çµæœï¼š${actual1} â†’ ${actual2}${v2 === v3 ? "ï¼ˆåŒç€ï¼‰" : ""} â†’ ${actual3}${v2 === v3 ? "ï¼ˆåŒç€ï¼‰" : ""}<br>
          <span class="${hit ? "hit" : "miss"}">
            ${hit ? "ğŸ‰ çš„ä¸­ï¼" : "âŒ ãƒã‚ºãƒ¬"}
          </span>
        `;

        board.appendChild(div);
      });
    }

    loadAllResults();
  </script>

</body>
</html>


    loadResult();
  </script>

</body>
</html>
